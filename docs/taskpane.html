<!doctype html><html lang="en" data-framework="typescript"><head><meta charset="UTF-8"/><meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.ngrok.com 'unsafe-eval' 'unsafe-inline'; font-src 'self' https://assets.ngrok.com https://cdn.ngrok.com;"><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>Synergia Contact Extractor</title><script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script><script>async function extractContact(e){const t=Office.context.mailbox.item,s=t.from?.displayName||"",o=t.from?.emailAddress||"",a=o.split("@")[1]?.split(".")[0]||"",n=a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():"";t.body.getAsync(Office.CoercionType.Text,(async a=>{if(a.status!==Office.AsyncResultStatus.Succeeded)return console.error(a.error),void e.completed();const i=parseSignature(extractSignatureBlock(a.value,s),s,o,n);t.notificationMessages.addAsync("contactInfo",{type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:`Naam: ${i.name||"-"} | E-mail: ${i.email||"-"} | Tel: ${i.phone||"-"} | Organisatie: ${i.organization||"-"} | Postcode: ${i.postcode||"-"}`,icon:"Icon.80x80",persistent:!1},(async()=>{try{const e=await OfficeRuntime.auth.getAccessToken({allowSignInPrompt:!0}),s={givenName:i.name,emailAddresses:[{address:i.email,name:i.name}],businessPhones:[i.phone],companyName:i.organization,homeAddress:{postalCode:i.postcode}},o=await fetch("https://graph.microsoft.com/v1.0/me/contacts",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){const e=await o.text();throw new Error(`${o.status} ${e}`)}t.notificationMessages.addAsync("saveSuccess",{type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Contact opgeslagen!",icon:"Icon.80x80",persistent:!1})}catch(e){console.error(e),t.notificationMessages.addAsync("saveError",{type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:"❌ Opslaan mislukt: "+e.message,persistent:!1})}finally{e.completed()}}))}))}function extractSignatureBlock(e,t){if(t){const s=e.indexOf(t);if(s>=0)return e.substring(s).trim()}const s=e.split(/\r?\n\s*\r?\n/);return(s.length>1?s.pop():e).trim()}function parseSignature(e,t,s,o){const a=e.split(/\r?\n/).map((e=>e.trim())).filter((e=>e));let n="";if(t&&e.toLowerCase().includes(t.toLowerCase()))n=t;else for(const e of a)if(!e.includes(s)&&!(/\+?\d[\d\-\u2013()\s]{5,}\d/.test(e)||/https?:\/\//i.test(e)||/www\./i.test(e)||/^[\+\d]/.test(e))){n=e;break}const i=s,c=/(\+?\d[\d\-\u2013()\s]{5,}\d)/g,r=[];let f;for(;f=c.exec(e);)r.push(f[1]);const l=r.length?r.reduce(((e,t)=>e.length>=t.length?e:t)):"",m=/\b\d{4}\s?[A-Za-z]{2}\b/;let d="";for(const e of a){const t=e.match(m);if(t){d=t[0];break}}return{name:n,email:i,phone:l,organization:o,postcode:d}}Office.onReady((()=>{Office.actions.associate("extractContact",extractContact)}))</script><script defer="defer" src="polyfill.js"></script><script defer="defer" src="react.js"></script><script defer="defer" src="taskpane.js"></script></head><body style="width:100%;height:100%;margin:0;padding:0"><div id="container"></div><div id="tridentmessage" style="display:none;padding:10px">Deze add-in werkt niet in Edge Legacy of IE. Upgrade naar Office 2021 of M365.</div><script>(navigator.userAgent.includes("Trident")||navigator.userAgent.includes("Edge"))&&(document.getElementById("tridentmessage").style.display="block",document.getElementById("container").style.display="none")</script></body></html>